ready - started server on 0.0.0.0:3000, url: http://localhost:3000
info  - Loaded env from /home/user/webdev/hostelpulse/.env.local
warn  - SWC minify release candidate enabled. https://nextjs.org/docs/messages/swc-minify-enabled
event - compiled client and server successfully in 8.1s (1422 modules)
wait  - compiling /api/guests...
event - compiled client and server successfully in 545 ms (1434 modules)
wait  - compiling /api/auth/status...
event - compiled client and server successfully in 992 ms (1435 modules)
wait  - compiling /api/test-auth-flow...
event - compiled client and server successfully in 1983 ms (1432 modules)
Testing auth flow
Creating test user: test-1759079074529@example.com
User created: fae954fa-d7f5-43bb-85aa-d021b10a42dd
Successfully obtained token
User data from auth: {
  id: 'fae954fa-d7f5-43bb-85aa-d021b10a42dd',
  aud: 'authenticated',
  role: 'authenticated',
  email: 'test-1759079074529@example.com',
  email_confirmed_at: '2025-09-28T17:04:35.011711Z',
  phone: '',
  confirmed_at: '2025-09-28T17:04:35.011711Z',
  last_sign_in_at: '2025-09-28T17:04:35.275092Z',
  app_metadata: { provider: 'email', providers: [ 'email' ] },
  user_metadata: {
    email: 'test-1759079074529@example.com',
    email_verified: true,
    phone_verified: false,
    sub: 'fae954fa-d7f5-43bb-85aa-d021b10a42dd'
  },
  identities: [
    {
      identity_id: '7c8ac13b-ddcb-4841-95c2-d2e48e98ae0d',
      id: 'fae954fa-d7f5-43bb-85aa-d021b10a42dd',
      user_id: 'fae954fa-d7f5-43bb-85aa-d021b10a42dd',
      identity_data: [Object],
      provider: 'email',
      last_sign_in_at: '2025-09-28T17:04:34.982602Z',
      created_at: '2025-09-28T17:04:34.982675Z',
      updated_at: '2025-09-28T17:04:34.982675Z',
      email: 'test-1759079074529@example.com'
    }
  ],
  created_at: '2025-09-28T17:04:34.939965Z',
  updated_at: '2025-09-28T17:04:35.278738Z',
  is_anonymous: false
}
wait  - compiling /api/test-isolation...
event - compiled client and server successfully in 1137 ms (1432 modules)
Testing database isolation
User 1 created: 8eb6bdf5-b42f-4e25-8cc6-54bb7ca6adb4
User 2 created: ce848ba2-8dea-41ab-a932-ddc1885bef63
User 1 token obtained
User 2 token obtained
User 1 created guest: 9d394087-1d78-4e7f-b044-9bcbbcebaac5
User 2 created guest: 0a705227-e8c3-413d-be6e-11fd2c33509f
User 1 can see 1 guests
User 2 can see 1 guests
wait  - compiling /api/test-e2e...
event - compiled client and server successfully in 605 ms (1432 modules)
Testing end-to-end flow
User created: 30e86a1c-6269-4b9a-b92e-c9256ecdfdf8
User authenticated, starting end-to-end test
Step 1: Adding rooms
Created 2 rooms
Step 2: Adding beds
Created 2 beds
Step 3: Adding guests
Created 2 guests
Step 4: Making a booking
Created booking: 3eff7d4d-25f3-4874-a422-beb28f2d5b32
Step 5: Adding payment
Created payment: b2274ce3-9e06-44e6-89b7-86d5973cd604
Step 6: Creating housekeeping task
Housekeeping task creation error: {
  code: '22P02',
  details: null,
  hint: null,
  message: 'invalid input syntax for type uuid: "Housekeeping Staff"'
}
wait  - compiling...
event - compiled successfully in 99 ms (103 modules)
Testing end-to-end flow
User created: aba222b7-5dfa-414d-9569-f92d5f0bafaf
User authenticated, starting end-to-end test
Step 1: Adding rooms
Created 2 rooms
Step 2: Adding beds
Created 2 beds
Step 3: Adding guests
Created 2 guests
Step 4: Making a booking
Created booking: bdb513f0-049b-4821-bd11-3ec0c5e9dda0
Step 5: Adding payment
Created payment: fe9793a6-546a-438b-89e1-d0e3d60d0d6d
Step 6: Creating housekeeping task
Created housekeeping task: 00517112-6fce-434c-8554-84f5f59619ee
Step 7: Creating notification
Notification creation error: {
  code: '42501',
  details: null,
  hint: null,
  message: 'new row violates row-level security policy for table "notifications"'
}
wait  - compiling...
event - compiled successfully in 45 ms (93 modules)
wait  - compiling /api/test-e2e...
event - compiled client and server successfully in 910 ms (1432 modules)
Testing end-to-end flow
User created: f9ed262c-e583-4cb4-8c0d-f6609eac44ae
User authenticated, starting end-to-end test
Step 1: Adding rooms
Created 2 rooms
Step 2: Adding beds
Created 2 beds
Step 3: Adding guests
Created 2 guests
Step 4: Making a booking
Created booking: 0420e01b-38ae-43a3-860a-8f531fa02003
Step 5: Adding payment
Created payment: 8fd46318-c0ee-4e70-9129-9f31fa9a070c
Step 6: Creating housekeeping task
Created housekeeping task: ed956ca3-8885-4e31-a8a9-824c5beeeb40
Step 7: Creating notification
Created notification: 27e65ec5-f77f-4ee0-8a35-c136f79a28ef
Step 8: Verifying data
End-to-end test completed successfully {
  user: {
    id: 'f9ed262c-e583-4cb4-8c0d-f6609eac44ae',
    email: 'e2e-test-1759079253271@example.com'
  },
  rooms: { count: 2, expected: 2 },
  guests: { count: 2, expected: 2 },
  bookings: { count: 1, expected: 1 },
  payments: { count: 1, expected: 1 },
  housekeepingTasks: { count: 1, expected: 1 },
  notifications: { count: 1, expected: 1 },
  bookingDetails: {
    id: '0420e01b-38ae-43a3-860a-8f531fa02003',
    created_at: '2025-09-28T17:07:33.708156+00:00',
    guest_id: '9c7c69a2-e54b-4f84-9cbb-5db30fcd85dd',
    room_id: '41d39917-486b-41f3-954b-00bdcf7d061e',
    bed_id: null,
    check_in: '2025-09-29',
    check_out: '2025-09-30',
    status: 'confirmed',
    notes: null,
    owner_id: 'f9ed262c-e583-4cb4-8c0d-f6609eac44ae',
    guests: { name: 'John Doe' },
    rooms: { name: 'Room 101' }
  },
  success: true
}
